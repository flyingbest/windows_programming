# Window Programming

> 윈도우 API

윈도우 운영체제는 마이크로소프트사에서 만든 GUI(Graphic User Interface)기반의 운영체제로 현재 가장 많은 컴퓨터에 설치되어 있는 대표적인 웅영체제.

운영체제는 컴퓨터의 하드웨어와 소프트웨어를 제어하여, 사용자가 컴퓨터를 쓸 수 있게 만들어주는 시스템 프로그램.

즉, 운영체제는 응용 프로그램이 컴퓨터에 장착된 하드웨어들에 접근하는 방법들을 제어하고, 관리하므로 응용 프로그램은 각각의 운영체제가 만들어 놓은 규정에 따라서 만들어야 한다. 

API란 Application Programming Interface의 약자로 운영체제가 응용 프로그램을 개발하기 위해서 제공해주는 함수의 집합을 의미.

> MFC와 윈도우 API

MFC는 마이크로소프트 파운데이션 클래스(Microsoft Foundation Class)의 약자로 C/C++ 개발자들이 윈도우 API를 좀 더 쉽게 접근할 수 있도록 제공해주는 함수의 집합.

MFC 또한 내부적으로는 윈도우 API를 사용하고 있는데 MFC를 사용하여 프로그램을 개발하는 동안에도 수많은 위도우 API 함수들을 사용.

윈도우 API를 활용하면 윈도우 운영체제에서 사용되는 거의 모든 내용을 사용할 수 있다는 장점이 있음. 또한 세세한 속성까지도 컨트롤이 가능. 또한 간단한 조작에 사용되는 API들을 활용하면 작성하는 코드의 양을 줄일 수 있다는 장점도 있음.

-------

### 윈도우 프로그래밍 구조

윈도우 프로그램은 WinMain()과 WndProc() 두개의 함수로 구성되는데 두 개의 함수는 윈도우 프로그램의 필수 구성요소.

실제로 두 개의 함수만 작성되면 윈도우 운영체제에 새로운 윈도우 프로그램의 기본 구조가 완료된다.

WinMain() 함수는 윈도우를 구성하기 위한 내용들을 기술하여 윈도우 프로그램의 틀을 마련하기 위해서 사용하고, WndProc() 함수는 프로그램에 전달된 메시지에 대한 처리 모듈을 의미한다. 

기본적으로 WinMain() 함수는 함수의 이름을 변경할 수 없지만 WndProc() 함수는 프로그래머가 지정하여 다른 이름으로 변경이 가능.
WinMain 함수의 구성.

|WinMain 함수|
|------------|
|WNDCLASS 구조체 생성|
|CreateWindow (윈도우 생성)|
|ShowWindow (윈도우 출력)|
|메시지 루프 생성|

WinMain 함수는 생성할 윈도우의 속성을 설정하는 구조체를 생성하여 윈도우를 생성하고, 출력하는 과정을 거친다. 그리고 메시지 루프를 생성하여 발생하는 메시지를 메시지 처리 루틴으로 전달하는 역할을 수행한다.

> WinMain 함수

Dos에서 C언어를 사용해 프로그램을 개발해 본 사람은 main() 함수가 프로그램을 시작하는 엔트리 포인트(Entry point)라는 것을 익히 알고 있을 것이다. 모든 프로그램은 프로그램 시작점인 엔트리 포인트가 필요한데, 윈도우 프로그래밍에서는 WinMain()이라는 이름의 함수를 사용하며, 함수의 원형은 다음과 같이 정의되어 있다.

```
int APIENTRY WinMain( HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpszCmdParam, int nCmdShow)
```

WinMain 함수는 4개의 인수를 입력받도록 되어 있다.

|인수|의미|
|----|----|
|hlnstance|프로그램의 인스턴스 핸들|
|hPrevInstance|바로 이전에 실행된 현재 프로그램의 인스턴스 핸들, 항상 NULL로 사용|
|lpCmdLine|명령 줄에서 입력된 인자 값. 프로그램 실행 시에 전달하고자 하는 데이터를 전달하기 위해서 사용|
|nCmdShow|프로그램이 실행될 형태. 최소화, 최대화 또는 일반 모양 등의 값이 전달|

- Tip!

윈도우 운영체제는 기본적으로 멀티 프로세스를 지원. 이것은 동시에 여러 개의 프로그램을 실행 할 수 있다는 의미.

이러한 이유로 동일한 프로그램을 여러 번 실행시키는 것 또한 가능하다. 이러한 이유로 윈도우 운영체제는 실행되는 프로그램 마다 핸들을 부여하여 각각의 프로그램을 식별하기 위해서 사용되는데 이것을 '인스턴스 핸들'이라 부른다.

> WNDCLASS 구조체

WndMain 함수는 윈도우 프로그램을 만드는 일을 하는 함수. 함수 내에서는 다음과 같은 작업을 처리하도록 구성.
 1. 윈도우 클래스 정의
 2. 윈도우 클래스를 이용하여 프로그램 윈도우 생성
 3. 프로그램 윈도우 출력
 4. 메시지 루프 처리

첫 번째로 처리해야 하는 내용이 윈도우 클래스를 정의하는 것. 프로그램 윈도우를 생성하기 위해서는 윈도우의 속성 값들을 설정해 주어야 하는데, 윈도우 운영체제에서는 이 속성을 WNDCLASS라는 이름의 구조체를 이용하여 전달받도록 되어 있다.
WNDCLASS 구조체는 windows.h 파일에 다음과 같이 정의.
```
typedef struct tagWNDCLASSA {
	UNIT			style;			//생성하고자 하는 윈도우의 형태(style)를 지정하는 멤버.
	WNDPROC			lpfnWndProc; //메시지 처리를 담당하는 함수를 지정하는 멤버.
	int				cbClsExtra;	//예약 영역으로 보통은 사용하지 않는다. 사용하지 않는 경우 0으로 세팅.
	int				cbWndExtra;	//위와 동일.
	HINSTANCE		hInstance;	//윈도우 인스턴스 핸들 값을 지정하는 멤버.
									//WinMain 함수의 인자 값으로 입력된 값을 지정하여 사용.
	HICON			hIcon;		//프로그램에서 사용할 아이콘을 지정하는 멤버. LoadIcon() 함수 사용.
	HCURSOR			hCursor;		//프로그램에서 사용할 마우스 커서를 지정하는 멤버. LoadCursor() 함수 사용.
	HBRUSH			hbrBackground;	//윈도우의 배경색을 지정하기 위한 멤버.
	LPCSTR			lpszMenuName;	//프로그램에서 사용할 메뉴를 지정하기 위한 멤버.
	LPCSTR			lpszClassName;	//윈도우의 클래스 이름을 지정하기 위한 멤버.
} WNDCLASS;
```

> 윈도우 생성

윈도우 클래스 구조체의 설정이 완료되었다면 설정한 내용의 성격을 갖는 프로그램의 윈도우를 생성해야 한다. 윈도우를 생성하기 위해서는 CreateWindow() 함수를 사용.
```
HWND CreateWindow(lpszClassName, lpszWindowName, dwStyle, x, y, nWidth, nHeight,
				hwndParent, hmenu, hinst, lpvParam)
```


